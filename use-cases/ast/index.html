<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>AST - CodeLingo Docs</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">CodeLingo Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Overview</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../tutorials/getting-started/">Getting Started</a>
</li>

                        
                            
<li >
    <a href="../../tutorials/cs-perforce/">C# and Perforce</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Concepts <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../concepts/search/">Search</a>
</li>

                        
                            
<li >
    <a href="../../concepts/tenets/">Tenets</a>
</li>

                        
                            
<li >
    <a href="../../concepts/lexicons/">Lexicons</a>
</li>

                        
                            
<li >
    <a href="../../concepts/bots/">Bots</a>
</li>

                        
                            
<li >
    <a href="../../concepts/flows/">Flows</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../clql/">CLQL</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Use Cases <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li class="active">
    <a href="./">AST</a>
</li>

                        
                            
<li >
    <a href="../vcs/">VCS</a>
</li>

                        
                            
<li >
    <a href="../runtime/">Runtime</a>
</li>

                        
                            
<li >
    <a href="../integration/">Integration</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../../clql/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../vcs/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#abstract-syntax-tree-ast">Abstract Syntax Tree (AST)</a></li>
        
            <li class="second-level"><a href="#clql-vs-stylecop">CLQL vs StyleCop</a></li>
            
                <li class="third-level"><a href="#empty-block-statements">Empty Block Statements</a></li>
            
                <li class="third-level"><a href="#access-modifier-declaration">Access Modifier Declaration</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="abstract-syntax-tree-ast">Abstract Syntax Tree (AST)</h1>
<p>Abstract Syntax Tree (AST) <a href="../../lexicons">lexicons</a> are used to query static properties of source code. These are typically used to enforce project specific patterns such as layering violations as well as more general code smells.</p>
<h2 id="clql-vs-stylecop">CLQL vs StyleCop</h2>
<p>CLQL, like StyleCop, can express C# style rules and use them to analyze a project, file, repository, or pull request. CLQL, like StyleCop can customize a set of predefined rules to determine how they should apply to a given project, and both can define custom rules.</p>
<p>StyleCop supports custom rules by providing a SourceAnalyzer class with CodeWalker methods. The rule author can iterate through elements of the document and raise violations when the code matches a certain pattern. </p>
<p>CLQL can express all rules that can be expressed in StyleCop. By abstracting away the details of document walking, CLQL can express in 9 lines, <a href="../../style-enforcers/#empty-block-statements">a rule</a> that takes ~50 lines of StyleCop. In addition to being, on average, 5 times less code to express these patterns, CLQL queries can be <a href="../../clql.md/#query-generation">generated</a> by selecting the code code elements in an IDE.</p>
<p>CLQL is not limited to C# like StyleCop. CLQL can express logic about other domains of logic otuside of the scope of StyleCop, like version control.</p>
<h3 id="empty-block-statements">Empty Block Statements</h3>
<p>StyleCop can use a custom rule to raise a violation for all empty block statements:</p>
<pre><code class="cs">namespace Testing.EmptyBlockRule {
    using global::StyleCop;
    using global::styleCop.CSharp;

    [SourceAnalyzer(typeof(CsParser))]
    public class EmptyBlocks : SourceAnalyzer
    {
        public override void AnalyzeDocument(CodeDocument document)
        {
            CsDocument csdocument = (CsDocument)document;
            if (csdocument.RootElement != null &amp;amp;&amp;amp; !csdocument.RootElement.Generated)
            {
                csdocument.WalkDocument(
                    new CodeWalkerElementVisitor&amp;lt;object&amp;gt;(this.VisitElement),
                    null,
                    null);
            }
        }

        private bool VisitElement(CsElement element, CsElement parentElement, object context)
        {
            if (statement.StatementType == StatementType.Block &amp;&amp; statement.ChildStatements.Count == 0)
            {
                this.AddViolation(parentElement, statement.LineNumber, &quot;BlockStatementsShouldNotBeEmpty&quot;);
            }
        }


        private bool VisitStatement(Statement statement, Expression parentExpression, Statement parentStatement, CsElement parentElement, object context)
        {
            if (statement.StatementType == StatementType.Block &amp;&amp; statement.ChildStatements.Count == 0)
            {
                this.AddViolation(parentElement, statement.LineNumber, &quot;BlockStatementsShouldNotBeEmpty&quot;);
            }
        }
    }
}
</code></pre>

<pre><code class="xml">&lt;SourceAnalyzer Name=&quot;EmptyBlocks&quot;&gt;
  &lt;Description&gt;
    Code blocks should not be empty.
  &lt;/Description&gt;
  &lt;Rules&gt;
    &lt;RuleGroup Name=&quot;Fun Rules You Will Love&quot;&gt;
      &lt;Rule Name=&quot;BlockStatementsShouldNotBeEmpty&quot; CheckId=&quot;MY1000&quot;&gt;
        &lt;Context&gt;A block statement should always contain child statements.&lt;/Context&gt;
        &lt;Description&gt;Validates that the code does not contain any empty block statements.&lt;/Description&gt;
      &lt;/Rule&gt;
    &lt;/RuleGroup&gt;
  &lt;/Rules&gt;
&lt;/SourceAnalyzer&gt;
</code></pre>

<p>The same rule can be expressed in CLQL as the following <a href="tenets.md">tenet</a>:</p>
<pre><code class="clql">lexicons: 
  - ast/codelingo/csharp as cs
tenets:
  - Name: &quot;EmptyBlock&quot;
    Comment: &quot;A block statement should always contain child statements.&quot;
    Doc: &quot;Validates that the code does not contain any empty block statements.&quot;
    Match: 
      cs.block_stmt:
        !cs.element
</code></pre>

<p>The VisitStatement function contains the core logic of this StyleCop rule:</p>
<pre><code class="cs">private bool VisitStatement(Statement statement, Expression parentExpression, Statement parentStatement, CsElement parentElement, object context)
{
    if (statement.StatementType == StatementType.Block &amp;&amp; statement.ChildStatements.Count == 0)
    {
        this.AddViolation(parentElement, statement.LineNumber, &quot;BlockStatementsShouldNotBeEmpty&quot;);
    }
}
</code></pre>

<p>The VisitStatement method is run at every node of the AST tree, then a violation is added if the node is a block statement with no children.
In CLQL, the match statement expresses the logic of the query. Traversal is entirely abstracted away, and the tenet author only needs to express the condition for a "rule violation":</p>
<pre><code class="clql">cs.block_stmt:
  !cs.element
</code></pre>

<p>The above query will match against any block statement that does not contain anything at all. <code>cs.element</code> <a href="../../clql/#the-element-fact">matches all</a> C# elements, and the "!" operator performs <a href="../../clql/#negation">negation</a>. </p>
<h3 id="access-modifier-declaration">Access Modifier Declaration</h3>
<p>In this example, we'll exclude StyleCop's long setup and document traversal boilerplace and focus on the query, which raises a violation for all non-generated code that doesn't have a declared access modifier:</p>
<pre><code class="cs">private bool VisitElement(CsElement element, CsElement parentElement, object context)
{
    // Make sure this element is not generated.
    if (!element.Generated)
    {
        // Flag a violation if the element does not have an access modifier.
        if (!element.Declaration.AccessModifier)
        {
            this.AddViolation(element, &quot;AccessModifiersMustBeDeclared&quot;);
        }
    }
}
</code></pre>

<p>As in the <a href="../../comparison/ast/#empty-block-statements">empty block statements</a> example, to express the pattern in CLQL, the tenet author only needs to express conditions in the VisitElement body:</p>
<pre><code class="clql">cs.element:
  generated: &quot;false&quot;
  cs.declaration_stmt:
    cs.access_modifier: &quot;false&quot;
</code></pre>

<p>The above query matches all C# elements that are not generated, whose declaration does not have an access modifier.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
